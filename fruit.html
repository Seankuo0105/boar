<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>山豬接水果</title>
<link rel="icon" type="image/png" href="pig.png">
<style>
body {
    margin: 0;
    overflow: hidden;
    background-color: #cceeff;
    font-family: Arial, sans-serif;
}
#gameCanvas {
    display: block;
    background-color: #a2d5f2;
}
#startBtn, #restartBtn {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 24px;
    font-size: 20px;
    font-weight: bold;
    border: none;
    border-radius: 8px;
    background-color: #ff9933;
    color: white;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
}
#startBtn { top: 50%; }
#restartBtn { top: 60%; display: none; }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<button id="startBtn">開始遊戲</button>
<button id="restartBtn">再玩一次</button>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const startBtn = document.getElementById('startBtn');
const restartBtn = document.getElementById('restartBtn');

// 全螢幕
function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// 山豬角色
const pigImg = new Image();
pigImg.src = 'pig.png';
let pigWidth = 100;
let pigHeight = 100;
let pigX = canvas.width/2 - pigWidth/2;
let pigY = canvas.height - pigHeight - 20;

// 掉落物
const fruits = [];
const fruitEmojis = ['🍎','🍌','🍇','🍉','🍓'];
const bombEmoji = '💣';
const fruitSize = 40;

let score = 0;
let lives = 3;
let gameRunning = false;
let spawnTimer, gameTimer;

// 產生水果或炸彈
function spawnFruit(){
    const x = Math.random() * (canvas.width - fruitSize);
    let emoji;
    if(Math.random() < 0.2){ // 20% 炸彈
        emoji = bombEmoji;
    } else {
        emoji = fruitEmojis[Math.floor(Math.random()*fruitEmojis.length)];
    }
    fruits.push({x:x, y:-fruitSize, emoji:emoji});
}

function updateFruits(){
    for(let i=fruits.length-1;i>=0;i--){
        fruits[i].y += 5; // 固定速度

        if(fruits[i].y + fruitSize >= pigY &&
           fruits[i].x + fruitSize >= pigX &&
           fruits[i].x <= pigX + pigWidth){
            if(fruits[i].emoji === bombEmoji){
                lives--;
            } else {
                score++;
            }
            fruits.splice(i,1);
        } else if(fruits[i].y > canvas.height){
            fruits.splice(i,1);
        }
    }

    if(lives <= 0){
        endGame();
    }
}

function resetGame(){
    score = 0;
    lives = 3;
    fruits.length = 0;
    pigX = canvas.width/2 - pigWidth/2;
}

function drawInfo(){
    ctx.fillStyle='black';
    ctx.textAlign='left';
    ctx.font='32px Arial';
    ctx.fillText('山豬接水果',20,50);
    ctx.font='20px Arial';
    ctx.fillText('操作方式：滑鼠拖曳山豬接水果（小心炸彈！）',20,80);

    ctx.textAlign='right';
    ctx.font='24px Arial';
    ctx.fillText(`分數: ${score}`, canvas.width-20, 50);
    ctx.fillText(`生命: ${'❤️'.repeat(lives)}`, canvas.width-20, 80);
}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    drawInfo();

    // 山豬
    ctx.drawImage(pigImg,pigX,pigY,pigWidth,pigHeight);

    // 水果 & 炸彈
    ctx.font = `${fruitSize}px Arial`;
    ctx.textAlign='left';
    for(const f of fruits){
        ctx.fillText(f.emoji,f.x,f.y);
    }

    if(gameRunning) requestAnimationFrame(draw);
}

function gameLoop(){
    if(!gameRunning) return;
    updateFruits();
}

// 滑鼠控制
canvas.addEventListener('mousemove',(e)=>{
    const rect = canvas.getBoundingClientRect();
    pigX = e.clientX - rect.left - pigWidth/2;
    pigX = Math.max(0,Math.min(canvas.width-pigWidth,pigX));
});

// 開始遊戲
function startGame(){
    startBtn.style.display = 'none';
    restartBtn.style.display = 'none';
    resetGame();
    gameRunning = true;
    draw();
    spawnTimer = setInterval(spawnFruit,1000);
    gameTimer = setInterval(gameLoop,20);
}

// 結束遊戲
function endGame(){
    gameRunning = false;
    clearInterval(spawnTimer);
    clearInterval(gameTimer);

    ctx.fillStyle='black';
    ctx.font='50px Arial';
    ctx.textAlign='center';
    ctx.fillText(`遊戲結束！分數: ${score}`, canvas.width/2, canvas.height/2);
    restartBtn.style.display = 'block';
}

startBtn.addEventListener('click', startGame);
restartBtn.addEventListener('click', startGame);

// 初始畫面
ctx.fillStyle='black';
ctx.font='50px Arial';
ctx.textAlign='center';
ctx.fillText('山豬接水果', canvas.width/2, canvas.height/2 - 60);
ctx.font='26px Arial';
ctx.fillText('按下「開始遊戲」開始挑戰', canvas.width/2, canvas.height/2);

</script>
</body>
</html>

